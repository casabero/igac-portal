{% extends "base.html" %}

{% block title %}Convertidor SNC - IGAC Apps{% endblock %}

{% block page_title %}Convertidor Registros Catastrales{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto py-4">
    <div class="bg-white p-8 rounded-2xl border border-gray-200 shadow-sm">
        <div class="mb-8">
            <h2 class="text-xl font-bold text-gray-900 font-display">Carga de Archivos SNC</h2>
            <p class="text-sm text-gray-500 mt-1">Procesa archivos planos del Sistema Nacional Catastral directamente a
                Excel.</p>
        </div>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            <!-- 1. Selección de Registro -->
            <div>
                <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Paso 1: Tipo de
                    Registro</label>
                <select name="opcion"
                    class="block w-full rounded-xl border-gray-200 text-sm focus:border-accent focus:ring-accent shadow-sm py-3 px-4"
                    required>
                    <option value="" selected disabled>Seleccione una opción...</option>
                    <option value="1">Registro 1 SNC (Datos Básicos)</option>
                    <option value="2">Registro 2 SNC (Detalles Constructivos)</option>
                    <option value="3">Resoluciones Tipo 1 (Trámites Generales)</option>
                    <option value="4">Resoluciones Tipo 2 (Detalles Físicos)</option>
                    <option value="5">Resoluciones Tipo 3 (Decretos)</option>
                </select>
            </div>

            <!-- 2. Archivo -->
            <div>
                <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Paso 2: Archivo
                    Plano (.txt o .prn)</label>
                <div class="relative group">
                    <input type="file" name="archivo" id="archivo" class="hidden" required>
                    <label for="archivo"
                        class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50/50 hover:bg-white hover:border-accent transition-all cursor-pointer">
                        <span
                            class="material-symbols-outlined text-4xl text-gray-300 mb-2 group-hover:text-accent group-hover:scale-110 transition-transform">upload_file</span>
                        <span class="text-sm font-medium text-gray-500" id="file_label">Seleccionar o arrastrar
                            archivo</span>
                        <span class="mt-1 text-[10px] text-gray-400">Formatos: .txt, .prn (Codificación Latin-1)</span>
                    </label>
                </div>
            </div>

            <!-- 3. Acción -->
            <div class="pt-4">
                <button type="submit"
                    class="w-full flex justify-center items-center gap-2 py-3.5 px-4 border border-transparent rounded-xl text-sm font-bold text-white bg-gray-900 hover:bg-accent shadow-lg transition-all active:scale-95">
                    <span class="material-symbols-outlined text-[20px]">download</span>
                    Convertir y Descargar Excel
                </button>
            </div>
        </form>
    </div>

    <!-- Info Card -->
    <div class="mt-8 bg-blue-50/50 border border-blue-100 rounded-xl p-6 flex gap-4">
        <div class="text-blue-500">
            <span class="material-symbols-outlined">info</span>
        </div>
        <div>
            <h4 class="text-xs font-bold text-blue-700 uppercase tracking-wider mb-1">Nota Técnica</h4>
            <p class="text-xs text-blue-600 leading-relaxed">
                El convertidor mantiene la estructura original del IGAC (FWF). No se eliminan datos, solo se mapean a
                columnas legibles para auditoría.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block help_content %}
<div class="space-y-8 text-gray-600">
    <section>
        <h4 class="text-primary font-bold text-sm uppercase tracking-wider border-b pb-2 mb-4 flex items-center gap-2">
            <span class="material-symbols-outlined text-accent">description</span>
            1. Propósito de la Herramienta
        </h4>
        <p class="text-sm">Esta aplicación procesa archivos planos de ancho fijo (Fixed-Width format) exportados
            directamente desde el Sistema Nacional Catastral del IGAC.</p>
    </section>

    <section>
        <h4 class="text-primary font-bold text-sm uppercase tracking-wider border-b pb-2 mb-4 flex items-center gap-2">
            <span class="material-symbols-outlined text-accent">layers</span>
            2. Tipos de Registros Soportados
        </h4>
        <div class="grid grid-cols-1 gap-4">
            <div class="bg-gray-50 p-4 rounded-xl">
                <p class="font-bold text-gray-900 text-xs mb-1">Registro 1 (R1)</p>
                <p class="text-[12px]">Contiene la información básica: Propietario, Cédula, Dirección, Destino y
                    <b>Avalúo Actual</b>. Es el archivo base para cualquier análisis.</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl">
                <p class="font-bold text-gray-900 text-xs mb-1">Registro 2 (R2)</p>
                <p class="text-[12px]">Información física: Áreas de terreno por zonas, detalles de construcción, número
                    de pisos, baños y estrato.</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl">
                <p class="font-bold text-gray-900 text-xs mb-1">Resoluciones</p>
                <p class="text-[12px]">Registros de trámites internos. El sistema filtra automáticamente por el tipo de
                    registro (Resolución 1, 2 o 3) según la selección en el formulario.</p>
            </div>
        </div>
    </section>

    <section>
        <h4 class="text-primary font-bold text-sm uppercase tracking-wider border-b pb-2 mb-4 flex items-center gap-2">
            <span class="material-symbols-outlined text-accent">tips_and_updates</span>
            3. Recomendaciones
        </h4>
        <ul class="list-disc list-inside text-sm space-y-2">
            <li>Asegúrese de que el archivo no haya sido modificado manualmente en un editor de texto que pueda
                corromper el ancho fijo de las columnas.</li>
            <li>El encoding se detecta automáticamente (usualmente Latin-1), permitiendo procesar tildes y eñes
                correctamente.</li>
            <li>El archivo resultante se descarga instantáneamente tras el procesamiento.</li>
        </ul>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    const fileInput = document.getElementById('archivo');
    const fileLabel = document.getElementById('file_label');

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            fileLabel.innerHTML = `<b class="text-accent">✓ ${e.target.files[0].name}</b>`;
        }
    });

    // Drag and drop Visuals
    const dropzone = fileInput.parentElement;
    ['dragenter', 'dragover'].forEach(eventName => {
        dropzone.addEventListener(eventName, () => {
            dropzone.classList.add('border-accent', 'bg-blue-50/20');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, () => {
            dropzone.classList.remove('border-accent', 'bg-blue-50/20');
        }, false);
    });
</script>
{% endblock %}